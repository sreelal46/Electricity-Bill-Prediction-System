<link rel="stylesheet" href="/css/user-dashboard.css">


<!-- DATA HOLDER - NOW POPULATED BY SERVER VIA HANDLEBARS -->
<div id="dashboardData" data-daily='{{{dailyTrendJSON}}}' data-latest='{{{latestReadingJSON}}}'
  data-today='{{{todayReadingsJSON}}}'>
</div>

<div class="container">
  <!-- HEADER -->
  <header class="header">
    <div class="header-content">
      <h1 style="display: flex; align-items: center; gap: 0.5rem;">
        <i data-lucide="zap" style="width: 32px; height: 32px;"></i>
        Energy Dashboard
      </h1>
      <div class="header-subtitle">
        <span class="status-indicator" id="statusIndicator"></span>
        <span id="statusText">Live Monitoring</span>
      </div>
    </div>
    <div class="last-updated">
      Last updated: <span id="lastUpdate">--</span>
    </div>
  </header>

  <!-- KPI CARDS -->
  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="kpi-label">
        <div class="kpi-icon" style="background: rgba(59, 130, 246, 0.1); color: var(--accent-blue);">
          <i data-lucide="zap"></i>
        </div>
        Current Power
      </div>
      <div class="kpi-value" id="currentPower">--</div>
      <div class="kpi-change neutral" id="powerChange">Real-time monitoring</div>
    </div>

    <div class="kpi-card">
      <div class="kpi-label">
        <div class="kpi-icon" style="background: rgba(251, 191, 36, 0.1); color: var(--accent-yellow);">
          <i data-lucide="bar-chart-3"></i>
        </div>
        Today's Usage
      </div>
      <div class="kpi-value" id="todayUnits">--</div>
      <div class="kpi-change" id="todayChange">--</div>
    </div>

    <div class="kpi-card">
      <div class="kpi-label">
        <div class="kpi-icon" style="background: rgba(239, 68, 68, 0.1); color: var(--accent-red);">
          <i data-lucide="flame"></i>
        </div>
        Peak Demand
      </div>
      <div class="kpi-value" id="peak">--</div>
      <div class="kpi-change neutral" id="peakTime">Today's maximum</div>
    </div>

    <div class="kpi-card">
      <div class="kpi-label">
        <div class="kpi-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--accent-green);">
          <i data-lucide="trending-up"></i>
        </div>
        Monthly Total
      </div>
      <div class="kpi-value" id="consumption">--</div>
      <div class="kpi-change" id="monthlyChange">--</div>
    </div>
  </div>

  <!-- CHARTS -->
  <div class="charts-grid">
    <div class="chart-card">
      <div class="chart-header">
        <h3 class="chart-title">7-Day Energy Trend</h3>
        <div class="chart-controls">
          <button class="chart-btn active">Week</button>
        </div>
      </div>
      <div class="chart-container" id="dailyChartContainer">
        <canvas id="dailyChart"></canvas>
      </div>
    </div>

    <div class="chart-card">
      <div class="chart-header">
        <h3 class="chart-title">Today's Load Profile</h3>
        <div class="chart-controls">
          <button class="chart-btn active">Power</button>
        </div>
      </div>
      <div class="chart-container" id="loadChartContainer">
        <canvas id="loadChart"></canvas>
      </div>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-card">
    <div class="table-header">
      <h3 class="table-title">Recent Readings</h3>
      <!-- <input type="text" class="search-box" placeholder="Search readings..." id="searchBox"> -->
    </div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Time</th>
            <th>Voltage (V)</th>
            <th>Current (A)</th>
            <th>Power (W)</th>
            <th>Energy (kWh)</th>
          </tr>
        </thead>
        <tbody id="readingsTable">
          <tr>
            <td colspan="5" class="loading">
              <div class="spinner"></div>
              Loading data...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/js/user-dashboard.js"></script>