<link rel="stylesheet" href="/css/admin-alert.css">

<!-- Data holder for alerts status -->
<div id="alertsData" data-has-alerts="{{#if alerts}}true{{else}}false{{/if}}"
  data-alerts-count="{{#if alerts}}{{alerts.length}}{{else}}0{{/if}}" style="display: none;">
</div>

<div class="container">
  <div class="page-header">
    <a href="/admin/dashboard" class="back-link">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7" />
      </svg>
      Back to Dashboard
    </a>
    <h1>
      <i data-lucide="bell" style="width: 40px; height: 40px;"></i>
      Alerts & Notifications
    </h1>
    <p class="subtitle">Monitor system alerts and important notifications</p>
  </div>

  {{#if alerts}}
  {{#if (gt alerts.length 0)}}
  <div class="alerts-grid">
    {{#each alerts}}
    <div class="alert-card severity-{{this.severity}} status-{{this.status}}">
      <div class="alert-header">
        <div class="alert-type-wrapper">
          <div class="alert-icon">
            {{#if (eq this.alert_type "ILLEGAL_USAGE")}}
            <i data-lucide="zap" style="width: 22px; height: 22px;"></i>
            {{else if (eq this.alert_type "UNUSUAL_PATTERN")}}
            <i data-lucide="alert-triangle" style="width: 22px; height: 22px;"></i>
            {{else if (eq this.alert_type "METER_TAMPERING")}}
            <i data-lucide="shield-alert" style="width: 22px; height: 22px;"></i>
            {{else if (eq this.alert_type "VOLTAGE_FLUCTUATION")}}
            <i data-lucide="activity" style="width: 22px; height: 22px;"></i>
            {{else if (eq this.alert_type "PEAK_DEMAND")}}
            <i data-lucide="trending-up" style="width: 22px; height: 22px;"></i>
            {{else}}
            <i data-lucide="bell" style="width: 22px; height: 22px;"></i>
            {{/if}}
          </div>
          <div class="alert-type">
            {{#if this.alert_type}}{{formatAlertType this.alert_type}}{{else}}Unknown Alert{{/if}}
          </div>
        </div>
        <span class="severity-badge">{{#if this.severity}}{{this.severity}}{{else}}UNKNOWN{{/if}}</span>
      </div>

      <div class="alert-body">
        <div class="alert-message {{#unless this.message}}placeholder{{/unless}}">
          {{#if this.message}}{{this.message}}{{else}}No message available{{/if}}
        </div>

        <span class="status-badge {{#if this.status}}{{this.status}}{{else}}pending{{/if}}">
          {{#if this.status}}{{this.status}}{{else}}pending{{/if}}
        </span>

        <div class="alert-time">
          <i data-lucide="clock"></i>
          {{#if this.timestamp}}{{formatDate this.timestamp}}{{else}}Unknown time{{/if}}
        </div>
      </div>

      <div class="alert-footer">
        <div class="alert-user-info">
          <div class="alert-user-avatar">
            <i data-lucide="user" style="width: 12px; height: 12px;"></i>
          </div>
          <span class="alert-user-name">{{#if this.user_name}}{{this.user_name}}{{else}}Unknown User{{/if}}</span>
          <span style="color: var(--border);">â€¢</span>
          <span>{{#if this.user_id}}{{this.user_id}}{{else}}N/A{{/if}}</span>
        </div>
      </div>
    </div>
    {{/each}}
  </div>
  {{else}}
  <!-- Empty Alerts Array - All Clear State -->
  <div class="no-alerts">
    <div class="no-alerts-icon">
      <i data-lucide="check-circle" style="width: 60px; height: 60px;"></i>
    </div>
    <h2>All Clear!</h2>
    <p>No active alerts at the moment. Your system is running smoothly.</p>

    <div class="empty-state-features">
      <div class="empty-state-feature">
        <div class="empty-state-feature-icon">
          <i data-lucide="shield-check"></i>
        </div>
        <div class="empty-state-feature-content">
          <h4>System Monitored</h4>
          <p>All meters are being actively monitored 24/7</p>
        </div>
      </div>

      <div class="empty-state-feature">
        <div class="empty-state-feature-icon">
          <i data-lucide="bell"></i>
        </div>
        <div class="empty-state-feature-content">
          <h4>Real-Time Alerts</h4>
          <p>You'll be notified immediately if any issues arise</p>
        </div>
      </div>
    </div>

    <div class="empty-state-actions">
      <button class="empty-state-btn primary" onclick="location.reload()">
        <i data-lucide="refresh-cw"></i>
        <span>Refresh Alerts</span>
      </button>
      <a href="/admin/dashboard" class="empty-state-btn secondary">
        <i data-lucide="layout-dashboard"></i>
        <span>Back to Dashboard</span>
      </a>
    </div>
  </div>
  {{/if}}
  {{else}}
  <!-- No Alerts Data - Error State -->
  <div class="no-alerts">
    <div class="no-alerts-icon" style="background: rgba(239, 68, 68, 0.1); color: var(--accent-red);">
      <i data-lucide="alert-circle" style="width: 60px; height: 60px;"></i>
    </div>
    <h2>Unable to Load Alerts</h2>
    <p>There was a problem loading alert data. This might be a temporary issue.</p>

    <div class="empty-state-actions">
      <button class="empty-state-btn primary" onclick="location.reload()">
        <i data-lucide="refresh-cw"></i>
        <span>Refresh Page</span>
      </button>
      <a href="/admin/dashboard" class="empty-state-btn secondary">
        <i data-lucide="layout-dashboard"></i>
        <span>Back to Dashboard</span>
      </a>
    </div>
  </div>
  {{/if}}
</div>
<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>
<script>
  // Get alerts data from data attributes
  const alertsDataElement = document.getElementById('alertsData');
  const hasAlerts = alertsDataElement.dataset.hasAlerts === 'true';
  const alertsCount = parseInt(alertsDataElement.dataset.alertsCount || '0');

  // Initialize Lucide icons
  document.addEventListener('DOMContentLoaded', function () {
    if (typeof lucide !== 'undefined') {
      lucide.createIcons();
    }
  });
</script>