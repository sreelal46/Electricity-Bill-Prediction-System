<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
<link rel="stylesheet" href="/css/admin-user-daily-summary.css">
<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>


<div class="container">
  <div class="page-header">
    <a href="/" class="back-link">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7" />
      </svg>
      Back to Home
    </a>
    <h1><i data-lucide="trending-up"
        style="width: 40px; height: 40px; margin-right: 12px; vertical-align: middle;"></i>Energy Consumption Trend
    </h1>
    <p class="subtitle" id="pageSubtitle">Daily energy usage over the last 30 days</p>

    <!-- User Info Section -->
    {{#if weekTrend.[0]}}
    <div class="user-info-banner">
      <div class="user-avatar-large">
        <i data-lucide="user" style="width: 24px; height: 24px;"></i>
      </div>
      <div class="user-details">
        <div class="user-name">USER ID :{{weekTrend.[0].user_id}}</div>
        <div class="user-meta">
          <span class="meta-item">
            <i data-lucide="zap" style="width: 14px; height: 14px;"></i>
            <span>{{weekTrend.[0].approved_load_kw}} kW Approved Load</span>
          </span>
          <span class="meta-divider">•</span>
          <span class="meta-item">
            <i data-lucide="activity" style="width: 14px; height: 14px;"></i>
            <span>{{weekTrend.[0].approved_phase}}</span>
          </span>
          <span class="meta-divider">•</span>
          <span class="meta-item">
            <i data-lucide="hash" style="width: 14px; height: 14px;"></i>
            <span>{{weekTrend.[0].user_id}}</span>
          </span>
        </div>
      </div>
    </div>
    {{/if}}
  </div>

  <div class="trend-card">
    <div class="card-header">
      <div class="card-title" id="cardTitle">7-Day Energy Trend</div>
      <div class="period-selector">
        <button class="period-btn" data-period="today">Today</button>
        <button class="period-btn" data-period="week">Week</button>
        <button class="period-btn" data-period="10days">10 Days</button>
        <button class="period-btn" data-period="2weeks">2 Weeks</button>
        <button class="period-btn active" data-period="month">Month</button>
      </div>
    </div>

    <div class="chart-container" id="chartContainer">
      <canvas id="trendChart"></canvas>
    </div>

    <div class="stats-summary">
      <div class="stat-item">
        <div class="stat-icon blue">
          <i data-lucide="bar-chart-2" style="width: 20px; height: 20px;"></i>
        </div>
        <div class="stat-label">Average Daily</div>
        <div>
          <span class="stat-value" id="avgDaily">0.00</span>
          <span class="stat-unit" id="avgUnit">kWh</span>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon yellow">
          <i data-lucide="zap" style="width: 20px; height: 20px;"></i>
        </div>
        <div class="stat-label" id="peakLabel">Peak Day</div>
        <div>
          <span class="stat-value" id="peakDay">0.00</span>
          <span class="stat-unit" id="peakUnit">kWh</span>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon purple">
          <i data-lucide="trending-down" style="width: 20px; height: 20px;"></i>
        </div>
        <div class="stat-label" id="lowestLabel">Lowest Day</div>
        <div>
          <span class="stat-value" id="lowestDay">0.00</span>
          <span class="stat-unit" id="lowestUnit">kWh</span>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon green">
          <i data-lucide="battery-charging" style="width: 20px; height: 20px;"></i>
        </div>
        <div class="stat-label">Total Consumption</div>
        <div>
          <span class="stat-value" id="totalConsumption">0.00</span>
          <span class="stat-unit" id="totalUnit">kWh</span>
        </div>
      </div>
    </div>
  </div>

  <div style="margin-top: 2rem;">
    <a href="/user/dashboard" class="back-link">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7" />
      </svg>
      Back to Dashboard
    </a>
  </div>
</div>

<!-- Hidden data attributes to pass backend data to JavaScript -->
<div id="chartData" style="display: none;" data-week='{{json weekTrend}}' data-10days='{{json _10dayTrend}}'
  data-2weeks='{{json _2WeekTrend}}' data-month='{{json monthTrend}}' data-today='{{json todayReadings}}'>
</div>
<script src="/js/admin-user-daily-summary.js"></script>